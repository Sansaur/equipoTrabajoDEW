<html>
    <head>
        <title>eBay Search Results</title>
        <style type="text/css">body { font-family: arial,sans-serif;} </style>
        <script src="../js/libs/jquery-1.12.4.js"></script>
        <script>
            // URL Con documentación sobre todo este rollo: https://developer.ebay.com/Devzone/finding/CallRef/index.html
            
            //Array de filtros que vayamos a usar. Tienen uso en buildURLArray()
            var filterarray = [
                {"name": "MaxPrice",
                    "value": "25",
                    "paramName": "Currency",
                    "paramValue": "USD"},
                {"name": "FreeShippingOnly",
                    "value": "true",
                    "paramName": "",
                    "paramValue": ""},
                {"name": "ListingType",
                    "value": ["AuctionWithBIN", "FixedPrice", "StoreInventory"],
                    "paramName": "",
                    "paramValue": ""},
            ];
            // Variable que se le añade a la URL para aplicar los filtros, se construye en buildURLArray
            var urlfilter = "";

            /**
             * Esta función construye la variable urlfilter a partir de los objetos en el array de filtros
             * @returns {undefined}
             */
            function  buildURLArray() {
                // Pasamos por cada filtro
                for (var i = 0; i < filterarray.length; i++) {
                    // Cogemos el objeto al que apunte el filtro
                    var itemfilter = filterarray[i];
                    // Por cada parámetro del objeto...
                    for (var index in itemfilter) {
                        // ... Revisamos si tienen valor
                        if (itemfilter[index] !== "") {
                            // ... Comprobamos si es un Array
                            // Si es un array, hacemos iteración por cada uno de sus valores y los añadimos a urlfilter
                            if (itemfilter[index] instanceof Array) {
                                for (var r = 0; r < itemfilter[index].length; r++) {
                                    var value = itemfilter[index][r];
                                    urlfilter += "&itemFilter\(" + i + "\)." + index + "\(" + r + "\)=" + value;
                                }
                            }
                            // Si no, urlfilter será rellenada con el valor de por si.
                            else {
                                urlfilter += "&itemFilter\(" + i + "\)." + index + "=" + itemfilter[index];
                            }
                        }
                    }
                }
                
                console.log("URL de filtros:"+ urlfilter);
            }

            // Construimos la URL con los filtros.
            buildURLArray(filterarray);
            
            // Esta es la URL completa que se usará para contactar con la API de eBay.
            var url = "http://svcs.ebay.com/services/search/FindingService/v1";
            // Qué operación vamos a realizar.
            url += "?OPERATION-NAME=findItemsByKeywords";
            url += "&SERVICE-VERSION=1.0.0";
            // Nuestra Application Key
            url += "&SECURITY-APPNAME=ArmandoS-equipoTr-PRD-d5d80d3bd-e53316c1";
            // Nos vamos a conectar a los servidores de españa de eBay.
            url += "&GLOBAL-ID=EBAY-ES";
            url += "&RESPONSE-DATA-FORMAT=JSON";
            url += "&REST-PAYLOAD";
            // Tendremos que cambiar las palabras claves
            url += "&keywords=harry%20potter";
            url += "&paginationInput.entriesPerPage=3";
            // Añadimos nuestros filtros.
            url += urlfilter;

            // Aquí realizamos la llamada a la URL construida previamente, en el success pondremos la generación de datos.
            $.ajax({
                url: url,
                jsonp: "callback",
                dataType: "jsonp",
                success: function (response) {
                    console.log(response);
                },
                complete: function () {

                },
                error: function (error, codigo, algo) {
                    console.error(error);
                    console.error(codigo);
                    console.error(algo);
                }
            });
        </script>
    </head> 
    <body>
        <h1>eBay Search Results</h1>
        <div id="results"></div>
    </body>
</html>